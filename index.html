<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weihnachtsmarkt Earnings Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Jost:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>

    <h1 id="header-title"><span>Part-Time <br>Job Calculator</span></h1>

    <div class="settings-area">
        <div id="job-detail-div">
                <h3>1. Job Details</h3>
            <label>
                Hourly Wage (€):
                <input type="number" id="hourly-rate" value="13">
            </label>
            <label>
                Hours per Shift: 
                <input type="number" id="shift-hours" value="4">
            </label>
        </div>

        <div id="market-duration-div">
            <h3>2. Market Duration</h3>
            <label>
                Start Date:
                <input type="date" id="start-date" value="2025-11-29">
            </label>
            <label>
                End Date:
                <input type="date" id="end-date" value="2025-12-28">
            </label>
        </div>
        

        <button id="generate-weeks-btn">Generate Schedule</button>
    </div>

    <div id="schedule-area" style="display:none;">
        <h3>3. Select Working Days</h3>
        <p>Check the boxes for the days you will work.</p>
        
        <div class="weeks-container" id="weeks-container"></div>

        <br>
        <button id="calculate-btn">Calculate Total Earnings</button>
    </div>

    <div id="result-area">
        <h3>Total Earnings: <span id="total-display">0.00 €</span></h3>
        <p>Total Hours: <span id="hours-display">0</span></p>
    </div>

    <script>
        // --- STEP 1: SELECT DOM ELEMENTS ---
        // We grab the HTML elements we need to interact with using their IDs.
        const generateBtn = document.getElementById('generate-weeks-btn');
        const calculateBtn = document.getElementById('calculate-btn');
        const weeksContainer = document.getElementById('weeks-container');
        const scheduleArea = document.getElementById('schedule-area');
        
        // Inputs
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');
        const hourlyRateInput = document.getElementById('hourly-rate');
        const shiftHoursInput = document.getElementById('shift-hours');
        
        // Display Outputs
        const totalDisplay = document.getElementById('total-display');
        const hoursDisplay = document.getElementById('hours-display');

        // --- STEP 2: HELPER FUNCTIONS ---
        
        // This function adds days to a date. 
        // Example: addDays(Nov 24, 1) -> Nov 25
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        // This converts a Javascript Date object to a readable string like "Mon Nov 24"
        function formatDate(date) {
            // 'en-US' makes it English. You can change to 'de-DE' for German.
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // --- STEP 3: GENERATE THE SCHEDULE ---
        
        // --- STEP 3: GENERATE THE SCHEDULE (UPDATED) ---
        
        generateBtn.addEventListener('click', function() {
            // 1. Get the values from the date inputs
            const start = startDateInput.valueAsDate;
            const end = endDateInput.valueAsDate;



            // capture the default shift length to use for every day
            const defaultHours = shiftHoursInput.value; 

            // Simple validation
            if (!start || !end || start > end) {
                alert("Please check your dates!");
                return;
            }

            // 2. Clear any previous schedule
            weeksContainer.innerHTML = '';
            
            // 3. Loop through dates to create weeks
            let currentDate = new Date(start);
            let weekCount = 1;

            // Create the first week wrapper
            let currentWeekDiv = document.createElement('div');
            currentWeekDiv.className = 'week-box'; 
            currentWeekDiv.innerHTML = `
            
           <div id="WeekText">
                <h4>Week ${weekCount}</h4>
                <h4>Hours</h4>
            </div>
            `;
            
            weeksContainer.appendChild(currentWeekDiv);

            let OperationCounter = 0;

            while (currentDate <= end) {

                // Create a container for this specific day (for better layout control)
                const dayContainer = document.createElement('div');
                dayContainer.className = 'day-row';   

                
                // 1. The Checkbox
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'day-checkbox';
                
                // 2. The Label (Date)
                const label = document.createElement('label');
                // Add a non-breaking space for spacing
                label.innerHTML = "&nbsp;" + formatDate(currentDate);
                label.style.flexGrow = "1"; // Push the input to the right if needed
                
                // Put checkbox inside label so clicking the text also checks the box
                label.prepend(checkbox);

                // 3. The Specific Hour Input (NEW!)
                const hourInput = document.createElement('input');
                hourInput.type = 'number';
                hourInput.className = 'day-hours-input'; // Class to find it later
                hourInput.value = defaultHours; // Set the default value from the top setting

                
                // Add elements to the day container
                dayContainer.appendChild(label);
                dayContainer.appendChild(hourInput);
                
                // Add the day container to the week
                currentWeekDiv.appendChild(dayContainer);

                // Check if it's Sunday to start a new week
                if (currentDate.getDay() === 0 && currentDate < end) {
                    weekCount++;
                    currentWeekDiv = document.createElement('div');
                    currentWeekDiv.className = 'week-box';
                    currentWeekDiv.style.marginTop = "20px"; 
                    currentWeekDiv.innerHTML = `<h4>Week ${weekCount}</h4>`;
                    weeksContainer.appendChild(currentWeekDiv);
                }


                // Move to next day
                currentDate = addDays(currentDate, 1);
            }

            // Show the schedule area
            scheduleArea.style.display = 'block';

            weeksContainer.scrollIntoView({ behavior: 'smooth'});
            console.log("Schedule generated. Scrolled into view");
            
        });

        // --- STEP 4: CALCULATE EARNINGS (UPDATED) ---

        calculateBtn.addEventListener('click', function() {
            // 1. Find all checkboxes that are CHECKED
            const checkedBoxes = document.querySelectorAll('.day-checkbox:checked');
            
            let totalHours = 0;

            // 2. Loop through each checked box to find its specific hours
            checkedBoxes.forEach(function(box) {
                // DOM TRAVERSAL:
                // The structure is: 
                // <div class="day-row"> 
                //    <label><input checkbox/></label> 
                //    <input class="day-hours-input"/> 
                // </div>
                
                // The 'box' is the checkbox.
                // Its parent is the <label>.
                // The label's parent is the <div class="day-row">
                
                // We need to find the input inside the SAME "day-row" container.
                const rowContainer = box.closest('.day-row');
                const hourInput = rowContainer.querySelector('.day-hours-input');
                
                // Get the value from that specific input
                const hoursForThisDay = parseFloat(hourInput.value);
                
                // Add to total (if it's a valid number)
                if (!isNaN(hoursForThisDay) && hoursForThisDay > 0 && hoursForThisDay <= 24) {
                    totalHours += hoursForThisDay;
                }else {
                    alert("Please enter valid hours (0-24) for selected days.");
                }
            });

            // 3. Get wage
            const wage = parseFloat(hourlyRateInput.value);

            // 4. Calculate Total Money
            const totalMoney = totalHours * wage;

            // 5. Update Display
            hoursDisplay.textContent = totalHours;
            totalDisplay.textContent = totalMoney.toFixed(2) + " €";
        });

    </script>
</body>
</html>
